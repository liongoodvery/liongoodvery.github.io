I"é4<h2 id="å¤ä¹ ">å¤ä¹ </h2>
<ul>
  <li>1.ä»€ä¹ˆæ˜¯æŒ‡é’ˆï¼Ÿ</li>
  <li>2.æŒ‡é’ˆçš„ä½œç”¨ï¼Ÿ</li>
  <li>3.æŒ‡é’ˆç›¸å…³çš„è¿ç®—ç¬¦ï¼Ÿ &amp; *</li>
  <li>4.æŒ‡é’ˆçš„æ•°æ®ç±»å‹å’ŒæŒ‡é’ˆç±»å‹ char *p; int *q;</li>
  <li>5.æŒ‡é’ˆå˜é‡ä¿å­˜å¸¦æœ‰ç±»å‹åœ°å€</li>
  <li>6.æŒ‡é’ˆçš„è¿ç®—</li>
</ul>

<h3 id="æŒ‡é’ˆå’Œæ•°ç»„çš„å…³ç³»">æŒ‡é’ˆå’Œæ•°ç»„çš„å…³ç³»</h3>

<ul>
  <li>æŒ‡é’ˆå˜é‡ä¿å­˜æ•°ç»„å <code class="highlighter-rouge">int a[6]; int *p = a;</code></li>
</ul>

<hr />

<figure class="highlight"><pre><code class="language-text" data-lang="text">    a[i]	&lt;=&gt; 	*(a + i)	&lt;=&gt;	*(p + i)	&lt;=&gt; 	p[i]
    </code></pre></figure>

<h3 id="å­—ç¬¦ä¸²">å­—ç¬¦ä¸²</h3>
<ul>
  <li>cè¯­è¨€ä¸­ä½¿ç”¨å­—ç¬¦æ•°ç»„ä¿å­˜å­—ç¬¦ä¸² char buf[5],å­—ç¬¦ä¸²ä¿å­˜æ—¶éœ€è¦å¤šä¸€ä¸ªå­—èŠ‚ä¿å­˜å­—ç¬¦ä¸²ç»“æŸæ ‡å¿—â€™\0â€™</li>
  <li>ç”¨å­—ç¬¦æŒ‡é’ˆchar *pæ‰¾åˆ°å­—ç¬¦ä¸²</li>
  <li>ç”¨string.hå¤´æ–‡ä»¶æä¾›å­—ç¬¦ä¸²å¤„ç†ç›¸å…³å‡½æ•°å£°æ˜</li>
</ul>

<h3 id="ç»“æ„ä½“">ç»“æ„ä½“</h3>
<ul>
  <li>ç”¨ç»“æ„ä½“å®šä¹‰æ–°æ•°æ®ç±»å‹ struct
  å§“å				å­¦å·			å¹´é¾„			æˆç»©
  char name[20]	int id;		int age;	float score;</li>
</ul>

<h3 id="å‡½æ•°æŒ‡é’ˆ">å‡½æ•°æŒ‡é’ˆ</h3>
<ul>
  <li>å‡½æ•°çš„å…¥å£åœ°å€ï¼šäºŒè¿›åˆ¶ä»£ç åœ¨ä»£ç æ®µèµ·å§‹ä½ç½®ï¼Œå‡½æ•°åä»£è¡¨å‡½æ•°çš„å…¥å£åœ°å€ã€‚</li>
  <li>å‡½æ•°æŒ‡é’ˆå˜é‡ä¿å­˜å‡½æ•°å…¥å£åœ°å€</li>
</ul>

<hr />

<figure class="highlight"><pre><code class="language-c" data-lang="c">    <span class="kt">void</span> <span class="nf">fun1</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">);</span><span class="c1">//å‡½æ•°å£°æ˜
</span>
    <span class="kt">void</span> <span class="nf">fun1</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">){</span> <span class="c1">//å‡½æ•°çš„å®šä¹‰
</span>
    <span class="k">return</span> <span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kt">void</span> <span class="o">*</span><span class="nf">fun2</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">b</span><span class="p">);</span><span class="c1">//å‡½æ•°çš„å£°æ˜
</span>
    
    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)(</span><span class="kt">int</span><span class="p">);</span><span class="c1">//å‡½æ•°æŒ‡é’ˆå˜é‡çš„å®šä¹‰
</span>
    
    <span class="n">p</span> <span class="o">=</span> <span class="n">fun1</span><span class="p">;</span>
    
    <span class="kt">void</span> <span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">pfun</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="p">);</span><span class="c1">//å‡½æ•°æŒ‡é’ˆå˜é‡å®šä¹‰
</span>
    
    </code></pre></figure>

<h3 id="typedefèµ·åˆ«å">typedefèµ·åˆ«å</h3>

<ul>
  <li>typedef ç»™å­˜åœ¨çš„æ•°æ®ç±»å‹èµ·åˆ«å</li>
</ul>

<hr />

<figure class="highlight"><pre><code class="language-c" data-lang="c">    <span class="kt">int</span> <span class="n">a</span><span class="p">;</span><span class="c1">//aæ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œæ˜¯ä¸ªå˜é‡å
</span>
    
    <span class="k">typedef</span> <span class="kt">int</span> <span class="kt">int32_t</span><span class="p">;</span><span class="c1">//int32_tæ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œint32_tç±»å‹åˆ«åï¼Œint32_tå’Œintç­‰ä»·
</span>
    
    <span class="k">struct</span> <span class="n">Student</span><span class="p">{</span>
    <span class="c1">//...
</span>
    <span class="p">}</span><span class="n">stu</span><span class="p">,</span><span class="o">*</span><span class="n">ptr</span><span class="p">;</span><span class="c1">//stuæ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œæ˜¯ä¸ªå˜é‡å
</span>
    
    <span class="k">typedef</span> <span class="k">struct</span> <span class="n">Student</span><span class="p">{</span>
    <span class="c1">//...
</span>
    <span class="p">}</span><span class="n">stu</span><span class="p">;</span><span class="c1">//stuæ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œstuæ˜¯struct Studentç±»å‹çš„åˆ«å
</span>
    
    <span class="k">typedef</span> <span class="k">struct</span> <span class="n">Student</span> <span class="o">*</span><span class="n">pstu</span><span class="p">;</span><span class="c1">//pstuæ˜¯ç»“æ„ä½“æŒ‡é’ˆç±»å‹
</span>
    </code></pre></figure>

<h3 id="jnihå¤´æ–‡ä»¶">jni.hå¤´æ–‡ä»¶</h3>
<hr />

<figure class="highlight"><pre><code class="language-c" data-lang="c">     <span class="k">typedef</span> <span class="k">struct</span> <span class="n">JNINativeInterface</span><span class="o">*</span> <span class="n">JNIEnv</span><span class="p">;</span> <span class="c1">//JNIEnv * env;å˜é‡
</span>
    </code></pre></figure>

<p>åˆ©ç”¨envè°ƒç”¨struct JNINativeInterfaceä¸­çš„å‡½æ•°æŒ‡é’ˆå˜é‡</p>

<hr />

<figure class="highlight"><pre><code class="language-c" data-lang="c">    <span class="c1">//env &lt;=&gt; JNIEnv * &lt;=&gt; struct JNINativeInterface** äºŒçº§ç»“æ„ä½“æŒ‡é’ˆ
</span>
    <span class="n">jclass</span>      <span class="p">(</span><span class="o">*</span><span class="n">FindClass</span><span class="p">)(</span><span class="n">JNIEnv</span><span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">);</span>
    <span class="p">(</span><span class="o">**</span><span class="n">env</span><span class="p">).</span><span class="n">FindClass</span><span class="p">();</span>
    <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">FindClass</span><span class="p">();</span>
    </code></pre></figure>

<h3 id="jniå¼€å‘ç›¸å…³æ¦‚å¿µ">jniå¼€å‘ç›¸å…³æ¦‚å¿µ</h3>
<ul>
  <li>äº¤å‰ç¼–è¯‘ï¼šåœ¨ä¸€ä¸ªå¹³å°ä¸Šä¸ºå¦ä¸€ä¸ªå¹³å°ç¼–è¯‘ä»£ç ï¼Œä¸åŒçš„æ“ä½œç³»ç»Ÿwindows linux Mac OS X,ä¸åŒå¤„ç†å™¨æ¶æ„ X86 ARM Mips</li>
  <li>å·¥å…·é“¾ï¼šä¸€å¥—é¡ºåºè°ƒç”¨çš„ç¼–è¯‘å·¥å…·ï¼Œå½¢æˆä¸€ä¸ªé“¾æ¡</li>
  <li>å‡½æ•°åº“ï¼šå®ç°æŸç±»åŠŸèƒ½çš„å‡½æ•°é›†åˆï¼Œå‡½æ•°å·²ç»ç¼–è¯‘äºŒè¿›åˆ¶æœºå™¨ä»£ç ã€‚.hå¤´æ–‡ä»¶å£°æ˜å‡½æ•°,.so/.aåº“æ–‡ä»¶</li>
</ul>

<h3 id="é™æ€åº“å’ŒåŠ¨æ€åº“">é™æ€åº“å’ŒåŠ¨æ€åº“</h3>
<ul>
  <li>é™æ€åº“ .a :åªç”¨äºç¨‹åºé“¾æ¥ï¼Œé™æ€é“¾æ¥æŠŠåº“æ–‡ä»¶ä¸­å‡½æ•°å®ç°æ‹·è´åˆ°ç¨‹åºä¸­ã€‚æ‰€ä»¥ç¨‹åºè¿è¡Œæ—¶å€™ä¸éœ€åº“</li>
  <li>åŠ¨æ€åº“/å…±äº«åº“ .so ï¼š ç”¨äºç¨‹åºé“¾æ¥ï¼Œåªæ˜¯è®°å½•ç”¨åˆ°çš„å‡½æ•°ï¼Œæ‰€ä»¥åœ¨ç¨‹åºè¿è¡Œä¹‹å‰éœ€è¦å…ˆåŠ è½½åŠ¨æ€åº“</li>
</ul>

<h3 id="å¼€å‘å·¥å…·ä»‹ç»">å¼€å‘å·¥å…·ä»‹ç»</h3>
<ul>
  <li>NDKï¼šNative Development kit æœ¬åœ°å¼€å‘å·¥å…·é›†</li>
  <li>CDT :  C/C++ Development Tools ï¼š Eclipseæ’ä»¶</li>
  <li>Cygwin:åœ¨windowsä¸‹æä¾›ä¸€ä¸ªç±»unix linuxæ¨¡æ‹Ÿç¯å¢ƒ</li>
</ul>

<h3 id="ndkç›®å½•ç»“æ„">NDKç›®å½•ç»“æ„</h3>
<ul>
  <li>build ç›®å½•ä¸‹æœ‰ .mkæ–‡ä»¶ï¼ŒæŒ‡å¯¼å·¥ç¨‹æ„å»ºå’Œç¼–è¯‘</li>
  <li>docs å¼€å‘æ–‡æ¡£</li>
  <li>platforms		android-18\arch-arm\usr\ include å¤´æ–‡ä»¶ç›®å½• libåº“æ–‡ä»¶ç›®å½•</li>
  <li>prebuilt 		windows-x86_64\bin make.exeå·¥ç¨‹ç®¡ç†å™¨</li>
  <li>samples å¼€å‘å®ä¾‹</li>
  <li>toolchains å·¥å…·é“¾</li>
  <li>ndk-build.cmd è°·æ­ŒåŒ…è£…è¿‡çš„makeå·¥å…·</li>
</ul>

<h3 id="jniå¼€å‘æµç¨‹">jniå¼€å‘æµç¨‹</h3>
<p>ç›®æ ‡ï¼šä½¿ç”¨NDKå·¥å…·ç¼–è¯‘å‡ºæœ¬åœ°.soåŠ¨æ€åº“ï¼ŒæŠŠ.soåº“æ–‡ä»¶è£…å…¥åº”ç”¨ç¨‹åºã€‚</p>

<ul>
  <li>é˜¶æ®µ1 ç¼–ç </li>
  <li>æ–°å»ºAndroidå·¥ç¨‹ï¼Œç”¨nativeå£°æ˜æœ¬åœ°æ–¹æ³•ï¼Œè°ƒç”¨æœ¬åœ°æ–¹æ³•</li>
</ul>

<hr />

<figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="cm">/**
    * ç”¨nativeå£°æ˜çš„æœ¬åœ°æ–¹æ³•
    * @return cè¯­è¨€ä¸­æä¾›å­—ç¬¦ä¸²
    */</span>
    <span class="kd">public</span> <span class="kd">native</span> <span class="nc">String</span> <span class="nf">helloFromC</span><span class="o">();</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">click</span><span class="o">(</span><span class="nc">View</span> <span class="n">v</span><span class="o">){</span>
    <span class="nc">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">helloFromC</span><span class="o">(),</span> <span class="nc">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
    <span class="o">}</span>
    </code></pre></figure>

<ul>
  <li>æ–°å»ºjniæ–‡ä»¶å¤¹ï¼Œåœ¨å…¶ä¸­æ–°å»ºhello.cæºæ–‡ä»¶ï¼Œå®ç°æœ¬åœ°æ–¹æ³•</li>
</ul>

<hr />

<figure class="highlight"><pre><code class="language-c" data-lang="c">    <span class="cp">#include &lt;jni.h&gt;
</span>    <span class="cm">/**
    * jniè§„èŒƒ javaä¸­æœ¬åœ°æ–¹æ³•å¯¹åº”åˆ°cé‡Œé¢çš„å‡½æ•°åå¦‚ä¸‹|
    * Java_åŒ…å(åŒ…åä¸­çš„.éœ€æ”¹ä¸º_)_ç±»å_æœ¬åœ°æ–¹æ³•å
    * JNIEnv *env:ä»£è¡¨jniç¯å¢ƒï¼Œæä¾›javaå’Œcä¹‹å‰æ•°æ®è½¬æ¢æ–¹æ³•
    * jobject obj : æ˜¯è°ƒç”¨æœ¬åœ°æ–¹æ³•çš„ç±»çš„å¯¹è±¡
    */</span>
    <span class="n">jstring</span> <span class="nf">Java_com_itheima_hellofromc_MainActivity_helloFromC</span><span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">obj</span><span class="p">){</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"Hello From C!"</span><span class="p">;</span><span class="c1">// buf &lt;=&gt; &amp;buf[0] : char *
</span>
    <span class="c1">//éœ€è¦è½¬æ¢cä¸­char *å­—ç¬¦ä¸²ä¸ºjavaä¸­çš„String
</span>
    <span class="c1">//	jstring NewStringUTF(JNIEnv *env, const char *bytes);
</span>
    <span class="c1">//	env : JNIEnv * &lt;=&gt; struct JNINativeInterface* *
</span>
    <span class="c1">//	(**env).NewStringUTF();
</span>
    <span class="c1">//	(*env)-&gt;NewStringUTF();
</span>
    <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">NewStringUTF</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
    <span class="p">}</span>
    </code></pre></figure>

<ul>
  <li>é˜¶æ®µ2 ç¼–è¯‘</li>
</ul>

<ol>
  <li>åœ¨jniæ–‡ä»¶å¤¹ä¸‹æ–°å»ºAndroid.mkï¼ŒæŒ‡å¯¼ç¼–è¯‘</li>
  <li>åœ¨pathç¯å¢ƒå˜é‡ä¸­æŒ‡å®šndk-build.cmdæ–‡ä»¶æ‰€åœ¨è·¯å¾„</li>
  <li>åœ¨jniæ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œndk-buildï¼Œç”Ÿæˆå¹¶å®‰è£….soæ–‡ä»¶</li>
  <li>åœ¨è°ƒç”¨ç±»ä¸­åŠ è½½åŠ¨æ€åº“</li>
</ol>

<hr />

<figure class="highlight"><pre><code class="language-text" data-lang="text">    LOCAL_PATH := $(call my-dir)				#æŒ‡å®šæºæ–‡ä»¶å½“å‰ç›®å½•
     $(CLEAR_VARS)						#æ¸…é™¤LOCAL_XXXç¼–è¯‘å˜é‡ï¼ŒLOCAL_PATHé™¤å¤–
        := hello					#æŒ‡å®šç”Ÿæˆ(æ¨¡å—å)åŠ¨æ€åº“åhello,ç”Ÿæˆçš„åŠ¨æ€åº“æ–‡ä»¶ålibhello.so
    LOCAL_SRC_FILES := hello.c					#
     $(BUILD_SHARED_LIBRARY)				#æŒ‡å®šç¼–è¯‘ç›®æ ‡ç±»å‹ä¸ºåŠ¨æ€åº“.so

    static{
    System.loadLibrary("hello");//éœ€è¦ä¸å¸¦å‰åç¼€çš„åº“å
    }
    </code></pre></figure>

<h2 id="jniå¼€å‘ä¸­å¸¸è§é”™è¯¯">jniå¼€å‘ä¸­å¸¸è§é”™è¯¯</h2>
<ol>
  <li>æ‰¾ä¸åˆ°åº“Caused by: java.lang.UnsatisfiedLinkError: Couldnâ€™t load calc-jn1: findLibrary returned null
    <ul>
      <li>äº§ç”ŸåŸå› 1ï¼šåŠ è½½åº“åé”™è¯¯</li>
      <li>äº§ç”ŸåŸå› 2ï¼šç”Ÿæˆçš„åº“å’Œè¿è¡Œå¹³å°ä¸åŒ¹é…ï¼Œè§£å†³åŠæ³•åœ¨jniæ–‡ä»¶å¤¹ä¸‹æ–°å»ºApplication.mkæ–‡ä»¶å…¶ä¸­æŒ‡å®š APP_ABI := all ç”Ÿæˆæ‰€æœ‰æ”¯æŒå¹³å°çš„.soåº“</li>
    </ul>
  </li>
  <li>æ‰¾ä¸åˆ°æ–¹æ³• java.lang.UnsatisfiedLinkError: Native method not found: com.itheima.resultfromc.MainActivity.resultFromC:(II)I
    <ul>
      <li>äº§ç”ŸåŸå› 1ï¼šæœ¬åœ°æ–¹æ³•åä¸ç¬¦åˆè§„èŒƒ</li>
      <li>äº§ç”ŸåŸå› 2ï¼šæ²¡æœ‰åŠ è½½åº“</li>
    </ul>
  </li>
</ol>

<h2 id="javahå‘½ä»¤ç”¨æ³•">javahå‘½ä»¤ç”¨æ³•</h2>
<ul>
  <li>jdk1.6 éœ€åœ¨D:\jni02\code\02_ResultFromC\bin\classes ä¸comåŒå±‚ç›®å½•ä¸‹æ‰§è¡Œjavah</li>
  <li>jdkl.7 éœ€åœ¨D:\jni02\code\02_ResultFromC\src ä¸comåŒå±‚ç›®å½•ä¸‹æ‰§è¡Œjavah</li>
</ul>

<hr />

<figure class="highlight"><pre><code class="language-c" data-lang="c">    <span class="c1">//D:\jni02\code\02_ResultFromC\src&gt;javah com.itheima.resultfromc.MainActivity
</span>
    <span class="c1">//ç”Ÿæˆcom_itheima_resultfromc_MainActivity.h
</span>
    <span class="n">JNIEXPORT</span> <span class="n">jint</span> <span class="n">JNICALL</span> <span class="nf">Java_com_itheima_resultfromc_MainActivity_result_1from_1c</span>
    <span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="p">,</span> <span class="n">jobject</span><span class="p">,</span> <span class="n">jint</span><span class="p">,</span> <span class="n">jint</span><span class="p">);</span>
    </code></pre></figure>

<h2 id="ndkç»“åˆeclipseå¼€å‘">ndkç»“åˆeclipseå¼€å‘</h2>
<ul>
  <li>1.æ–°å»ºå·¥ç¨‹ï¼Œå£°æ˜æœ¬åœ°æ–¹æ³•ï¼Œè°ƒç”¨æœ¬åœ°æ–¹æ³•</li>
  <li>2.ç»™eclipseæŒ‡å®šndkè·¯å¾„</li>
  <li>3.æ·»åŠ æœ¬åœ°æ”¯æŒï¼Œè‡ªåŠ¨ç”Ÿæˆjniæ–‡ä»¶åŠcppæºæ–‡ä»¶ï¼ŒAndroid.mkæ–‡ä»¶ï¼Œæ”¹åç¼€å</li>
  <li>4.æ·»åŠ jniå¤´æ–‡ä»¶è·¯å¾„</li>
  <li>5.javahå‘½ä»¤ç”ŸåŒ…å«æœ¬åœ°å‡½æ•°åå¤´æ–‡ä»¶ï¼ŒæŠŠå¤´æ–‡ä»¶æ‹·è´jniæ–‡ä»¶å¤¹ï¼Œæœ¬åœ°å‡½æ•°åæ‹·è´åˆ°æºæ–‡ä»¶ï¼Œå®ç°åŠŸèƒ½</li>
  <li>6.æ·»åŠ åŠ è½½åŠ¨æ€åº“è¯­å¥</li>
  <li>7.è¿è¡Œç¨‹åºï¼Œè‡ªåŠ¨ç¼–è¯‘</li>
</ul>
:ET